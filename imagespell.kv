Root:
	orientation: 'vertical'
	ActionBarWidget:
		id: actionbar
	BoxLayout:
		BoxLayout:
			canvas.before:
				Color:
					rgba: .05, .05, .05, 1
				Rectangle:
					pos: self.pos
					size: self.size
			orientation: 'vertical'
			size_hint_x: .2
			MenuWidget:
				size_hint_y: .5
			Splitter:
				id: properties
				sizable_from: 'top'
				size_hint_y: .5
		BoxLayout:
			id: viewport
			size_hint_x: .8
			Label:
				text: 'Welcome to ImageSpell !'
				font_size: 30

<ActionBarWidget>:
	pos_hint: {'top': 1}
	ActionView:
		use_separator: True
		ActionPrevious:
			title: 'ImageSpell'
			with_previous: False
		ActionGroup:
			text: 'Image'
			mode: 'spinner'
			size_hint_x: None
			width: 90
			ActionButton:
				text: 'Open'
				on_release: root.parent.show_load()
			ActionButton:
				text: 'Save'
				on_release: root.parent.show_save()

<MenuWidget>:
	GridLayout:
		cols: 1
		size_hint_y: None
		height: 390
		Button:
			text: 'Rotate'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_rotate()
		Button:
			text: 'Resize'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_resize()
		Button:
			text: 'Flip'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_flip()
		Button:
			text: 'Sampling'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_sampling()
		Button:
			text: 'Copy & Paste'
			size_hint: 1, None
			height: 30
		Button:
			text: 'Quantization'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_quantization()
		Button:
			text: 'Histogram Equalization'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_equalizehist()
		Button:
			text: 'Mask'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_mask()
		Button:
			text: 'Blur'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_blur()
		Button:
			text: 'Edge Detection'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_edgedetection()
		Button:
			text: 'Colormap'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_colormap()
		Button:
			text: 'Segmentation'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_segmentation()
		Button:
			text: 'Morfologi'
			size_hint: 1, None
			height: 30
			on_release: root.parent.parent.parent.on_morphology()

<RotatePropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Rotation'
	Slider:
		id: rotation
		min: 0
		max: 360
		on_value:  if not(root.parent is None): root.parent.parent.parent.parent.on_rotate_update()

<ResizePropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Width Scale'
	FloatInput:
		id: width_scale
		text: '1'
		on_text: if not(root.parent is None): root.parent.parent.parent.parent.on_resize_update()
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Height Scale'
	FloatInput:
		id: height_scale
		text: '1'
		on_text: if not(root.parent is None): root.parent.parent.parent.parent.on_resize_update()

<FlipPropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Horizontal'
	Switch:
		id: horizontal
		on_active: if not(root.parent is None): root.parent.parent.parent.parent.on_flip_update()
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Vertical'
	Switch:
		id: vertical
		on_active: if not(root.parent is None): root.parent.parent.parent.parent.on_flip_update()

<SamplingPropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Factor'
	IntInput:
		id: factor
		text: '1'
		on_text: if not(root.parent is None): root.parent.parent.parent.parent.on_sampling_update()

<QuantizationPropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'K'
	IntInput:
		id: factor
		text: '1'
		on_text: if not(root.parent is None): root.parent.parent.parent.parent.on_quantization_update()

<EqualizeHistPropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5

<MaskPropertyWidget>:
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Mask Image'
	Button:
		id: type
		text: 'Select Image'
		on_release: root.parent.parent.parent.parent.show_load_mask()
		size_hint_y: None

<BlurPropertyWidget>:
	# trick to not lost the Dropdown instance
	__safe_id: [dropdown.__self__]
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Operator'
	Button:
		id: type
		text: 'Mean'
		on_release: dropdown.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_blur_update()

	DropDown:
		id: dropdown
		on_parent: self.dismiss()
		on_select: type.text = args[1]
		Button:
			text: 'Mean'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Mode'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Median'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Gaussian'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Kernel Size'
	Slider:
		id: kernel_size
		min: 3
		max: 31
		step: 2
		on_value: root.parent.parent.parent.parent.on_blur_update()

<EdgeDetectionPropertyWidget>:
	# trick to not lost the Dropdown instance
	__safe_id: [dropdown.__self__, direction_dropdown.__self__]
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Operator'
	Button:
		id: operator
		text: 'Prewitt'
		on_release: dropdown.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_edgedetection_update()

	DropDown:
		id: dropdown
		on_parent: self.dismiss()
		on_select: operator.text = args[1]
		Button:
			text: 'Prewitt'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Sobel'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Canny'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Laplacian'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
#		Button:
#			text: 'Prewitt 2'
#			size_hint_y: None
#			height: 30
#			on_release: dropdown.select(self.text)

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Kernel Size (Sobel)'
	IntInput:
		id: kernel_size
		text: '3'
		on_text: root.parent.parent.parent.parent.on_edgedetection_update()

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Min Values (Canny)'
	IntInput:
		id: min_values
		text: '100'
		on_text: root.parent.parent.parent.parent.on_edgedetection_update()

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Max Values (Canny)'
	IntInput:
		id: max_values
		text: '200'
		on_text: root.parent.parent.parent.parent.on_edgedetection_update()

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Operator'
	Button:
		id: direction
		text: 'Both'
		on_release: direction_dropdown.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_edgedetection_update()

	DropDown:
		id: direction_dropdown
		on_parent: self.dismiss()
		on_select: direction.text = args[1]
		Button:
			text: 'Both'
			size_hint_y: None
			height: 30
			on_release: direction_dropdown.select(self.text)
		Button:
			text: 'Horizontal'
			size_hint_y: None
			height: 30
			on_release: direction_dropdown.select(self.text)
		Button:
			text: 'Vertical'
			size_hint_y: None
			height: 30
			on_release: direction_dropdown.select(self.text)

<ColormapPropertyWidget>:
	# trick to not lost the Dropdown instance
	__safe_id: [dropdown.__self__]
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Color Map'
	Button:
		id: map
		text: 'Autumn'
		on_release: dropdown.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_colormap_update()

	DropDown:
		id: dropdown
		on_parent: self.dismiss()
		on_select: map.text = args[1]
		Button:
			text: 'Autumn'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Bone'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Jet'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Winter'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Rainbow'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Ocean'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Summer'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Spring'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Cool'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'HSV'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Pink'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Hot'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)

<SegmentationPropertyWidget>:
	# trick to not lost the Dropdown instance
	__safe_id: [dropdown.__self__]
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Foreground area'
	Button:
		id: mode
		text: 'Distance Transform'
		on_release: dropdown.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_segmentation_update()
	DropDown:
		id: dropdown
		on_parent: self.dismiss()
		on_select: mode.text = args[1]
		Button:
			text: 'Distance Transform'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)
		Button:
			text: 'Erosion'
			size_hint_y: None
			height: 30
			on_release: dropdown.select(self.text)

<MorphologyPropertyWidget>:
	# trick to not lost the Dropdown instance
	__safe_id: [dropdown_operation.__self__, dropdown_kernel.__self__]
	cols: 1
	row_default_height: 30
	row_force_default: True
	spacing: 0, 5
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Operation'
	Button:
		id: operation
		text: 'Erosion'
		on_release: dropdown_operation.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_morphology_update()

	DropDown:
		id: dropdown_operation
		on_parent: self.dismiss()
		on_select: operation.text = args[1]
		Button:
			text: 'Erosion'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Dilation'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Opening'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Closing'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Gradient'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Top Hat'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
		Button:
			text: 'Black Hat'
			size_hint_y: None
			height: 30
			on_release: dropdown_operation.select(self.text)
	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Kernel'
	Button:
		id: kernel
		text: 'Uniform'
		on_release: dropdown_kernel.open(self)
		size_hint_y: None
		on_text: root.parent.parent.parent.parent.on_morphology_update()

	DropDown:
		id: dropdown_kernel
		on_parent: self.dismiss()
		on_select: kernel.text = args[1]
		Button:
			text: 'Uniform'
			size_hint_y: None
			height: 30
			on_release: dropdown_kernel.select(self.text)
		Button:
			text: 'Rect'
			size_hint_y: None
			height: 30
			on_release: dropdown_kernel.select(self.text)
		Button:
			text: 'Ellipse'
			size_hint_y: None
			height: 30
			on_release: dropdown_kernel.select(self.text)
		Button:
			text: 'Cross'
			size_hint_y: None
			height: 30
			on_release: dropdown_kernel.select(self.text)

	Label:
		canvas.before:
			Color:
				rgba: 1, 1, 1, .1
			Rectangle:
				pos: self.pos
				size: self.size
		text: 'Kernel Size'
	Slider:
		id: kernel_size
		min: 3
		max: 11
		step: 2
		on_value: root.parent.parent.parent.parent.on_morphology_update()

<SingleDisplayWidget>:
	RelativeLayout:
		size_hint: 1, 1
		Image:
			id: image
			source: 'empty.png'
		Label:
			id: label
			halign: 'right'
			valign: 'top'
			text_size: self.size
			padding: 5, 1
			text: 'blank'
		Label:
			halign: 'left'
			valign: 'bottom'
			text_size: self.size
			padding: 5, 1
			text: "1 : " + ("%.2f" % max(1, image.texture_size[0]/image.width))


<QuadDisplayWidget>:
	canvas.after:
		Color:
			rgba: .05, .05, .05, 1
		Line:
			points: self.x+1, self.y+self.height/2, self.x+self.width, self.y+self.height/2
			width: 2
		Line:
			points: self.x+self.width/2, self.y, self.x+self.width/2, self.y+self.height
			width: 2
	orientation: 'vertical'
	BoxLayout:
		size_hint_y: .5
		RelativeLayout:
			size_hint_x: .5
			Image:
				id: top_left_image
				allow_stretch: True
				source: 'empty.png'
			Label:
				id: top_left_label
				halign: 'right'
				valign: 'top'
				text_size: self.size
				padding: 5, 1
				text: 'top left'
			Label:
				halign: 'left'
				valign: 'bottom'
				text_size: self.size
				padding: 5, 1
				text: "1 : " + ("%.2f" % max(1, top_left_image.texture_size[0]/top_left_image.width))
		RelativeLayout:
			size_hint_x: .5
			Image:
				id: top_right_image
				allow_stretch: True
				source: 'empty.png'
			Label:
				id: top_right_label
				halign: 'right'
				valign: 'top'
				text_size: self.size
				padding: 5, 1
				text: 'top right'
			Label:
				halign: 'left'
				valign: 'bottom'
				text_size: self.size
				padding: 5, 1
				text: "1 : " + ("%.2f" % max(1, top_right_image.texture_size[0]/top_right_image.width))
	BoxLayout:
		size_hint_y: .5
		RelativeLayout:
			size_hint_x: .5
			Image:
				id: bottom_left_image
				allow_stretch: True
				source: 'empty.png'
			Label:
				id: bottom_left_label
				halign: 'right'
				valign: 'top'
				text_size: self.size
				padding: 5, 1
				text: 'bottom left'
			Label:
				halign: 'left'
				valign: 'bottom'
				text_size: self.size
				padding: 5, 1
				text: "1 : " + ("%.2f" % max(1, bottom_left_image.texture_size[0]/bottom_left_image.width))
		RelativeLayout:
			size_hint_x: .5
			Image:
				id: bottom_right_image
				allow_stretch: True
				source: 'empty.png'
			Label:
				id: bottom_right_label
				halign: 'right'
				valign: 'top'
				text_size: self.size
				padding: 5, 1
				text: 'bottom right'
			Label:
				halign: 'left'
				valign: 'bottom'
				text_size: self.size
				padding: 5, 1
				text: "1 : " + ("%.2f" % max(1, bottom_right_image.texture_size[0]/bottom_right_image.width))

<LoadDialog>:
	BoxLayout:
		size: root.size
		pos: root.pos
		orientation: "vertical"
		FileChooserIconView:
			id: filechooser

		BoxLayout:
			size_hint_y: None
			height: 30
			Button:
				text: "Cancel"
				on_release: root.cancel()

			Button:
				text: "Load"
				on_release: root.load(filechooser.path, filechooser.selection, root.mask_image)

<SaveDialog>:
	text_input: text_input
	BoxLayout:
		size: root.size
		pos: root.pos
		orientation: 'vertical'
		FileChooserIconView:
			id: filechooser
			on_selection: text_input.text = self.selection and self.selection[0] or ''
		TextInput:
			id: text_input
			size_hint_y: None
			height: 30
			multiline: False
		BoxLayout:
			size_hint_y: None
			height: 30
			Button:
				text: 'Cancel'
				on_release: root.cancel()
			Button:
				text: 'Save'
				on_release: root.save(filechooser.path, text_input.text)
